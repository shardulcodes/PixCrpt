{% extends "base.html" %} {% block title %}Hide & Extract - Stego Tool{%
endblock %} {% block content %}
<!-- Flash Messages -->
{% with messages = get_flashed_messages(with_categories=true) %} {% if messages
%}
<ul class="messages">
  {% for category, message in messages %}
  <li class="{{ category }}">
    <i class="fas fa-info-circle"></i> {{ message }}
    <button class="close-btn" onclick="this.parentElement.remove()">âœ–</button>
  </li>
  {% endfor %}
</ul>
{% endif %} {% endwith %}

<main class="tool-grid">
  <!-- Hide Section -->
  <section class="tool-card encrypt-section" id="hide-focus">
    <h2><i class="fas fa-image"></i> Hide PNG in JPEG</h2>
    <form
      id="hide-form"
      method="POST"
      action="{{ url_for('masko.hide_image') }}"
      enctype="multipart/form-data"
    >
      <div class="drop-card">
        <label for="cover_jpeg"
          ><i class="fas fa-photo-video"></i> Cover JPEG</label
        >
        <div class="drop-box">
          <header><h4>Select JPEG file</h4></header>
          <p>Only .jpg/.jpeg allowed</p>
          <input
            type="file"
            name="cover_jpeg"
            id="cover_jpeg"
            accept=".jpeg,.jpg"
            hidden
            required
          />
          <button
            type="button"
            class="btn"
            onclick="document.getElementById('cover_jpeg').click();"
          >
            <i class="fas fa-upload btn-icon"></i> Choose JPEG
          </button>
        </div>
      </div>

      <div class="drop-card">
        <label for="secret_png"><i class="fas fa-lock"></i> Secret PNG</label>
        <div class="drop-box">
          <header><h4>Select PNG to hide</h4></header>
          <p>Only .png files allowed</p>
          <input
            type="file"
            name="secret_png"
            id="secret_png"
            accept="image/png"
            hidden
            required
          />
          <button
            type="button"
            class="btn"
            onclick="document.getElementById('secret_png').click();"
          >
            <i class="fas fa-upload btn-icon"></i> Choose PNG
          </button>
        </div>
      </div>

      <div class="progress-wrapper" style="display: none">
        <div class="progress-bar"></div>
      </div>

      <button type="submit" class="btn">
        <i class="fas fa-shield-alt btn-icon"></i> Hide Image
      </button>
    </form>
  </section>

  <!-- Extract Section -->
  <section class="tool-card decrypt-section" id="extract-focus">
    <h2><i class="fas fa-search"></i> Extract PNG from JPEG</h2>
    <form
      id="extract-form"
      method="POST"
      action="{{ url_for('masko.extract_image') }}"
      enctype="multipart/form-data"
    >
      <div class="drop-card">
        <label for="stego_jpeg">
          <i class="fas fa-upload"></i> Stego JPEG
        </label>
        <div class="drop-box">
          <header><h4>Select stego JPEG</h4></header>
          <p>Upload the JPEG that contains a hidden PNG</p>
          <input
            type="file"
            name="stego_jpeg"
            id="stego_jpeg"
            accept=".jpeg,.jpg"
            hidden
            required
          />
          <button
            type="button"
            class="btn"
            onclick="document.getElementById('stego_jpeg').click();"
          >
            <i class="fas fa-file-image btn-icon"></i> Choose JPEG
          </button>
        </div>
        
      </div>

      <div class="progress-wrapper" style="display: none">
        <div class="progress-bar"></div>
      </div>

      <button type="submit" class="btn">
        <i class="fas fa-download btn-icon"></i> Extract Image
      </button>
    </form>
  
</main>
<aside class="stego-info-sidebar" aria-label="Stego information">
  <div class="info-inner">
    <header>
      <h3><i class="fas fa-info-circle"></i> Detection Notice</h3>
      
    </header>

    <div>
  <p>
    <strong>Detection notice:</strong> Files processed by this tool may be flagged as suspicious by automated scanners, upload validators, or forensic tools. Detection likelihood depends on the policies of the receiving system.
  </p>

  <ul>
    <li><strong>Practical impact:</strong> Some platforms may reject, sanitize, or mark files as problematic during upload or review.</li>
    <li><strong>Product guidance:</strong> If your workflow requires lower detection risk, consider using the alternative encryption feature which is purpose-built for that use case.</li>
  </ul>


</div>

  </div>
</aside>

{% endblock %} {% block head %}
<script>
  document.addEventListener("DOMContentLoaded", function () {
    // Navbar transparency
    const navbar = document.querySelector(".navbar");
    if (navbar) {
      window.addEventListener("scroll", () => {
        const scrollY = window.scrollY;
        if (scrollY > 10) {
          navbar.style.backgroundColor = "rgba(255, 255, 255, 0.15)";
          navbar.style.boxShadow = "0 2px 4px rgba(0,0,0,0.05)";
        } else {
          navbar.style.backgroundColor = "rgba(255, 255, 255, 0)";
          navbar.style.boxShadow = "none";
        }
      });
    }

    // File name update
    function updateFileName(inputId) {
      const input = document.getElementById(inputId);
      if (!input) return;
      input.addEventListener("change", () => {
        const header = input.closest(".drop-box").querySelector("header h4");
        if (input.files.length > 0) {
          header.textContent =
            input.files.length > 1
              ? `${input.files.length} files selected`
              : input.files[0].name;
        }
      });
    }
    updateFileName("cover_jpeg");
    updateFileName("secret_png");
    updateFileName("stego_jpeg");

    // Fake progress
    function attachFakeProgress(formId) {
      const form = document.getElementById(formId);
      if (!form) return;
      const progressWrapper = form.querySelector(".progress-wrapper");
      const progressBar = progressWrapper.querySelector(".progress-bar");

      form.addEventListener("submit", function (e) {
        e.preventDefault();
        progressWrapper.style.display = "block";
        let progress = 0;
        const interval = setInterval(() => {
          progress += 1;
          progressBar.style.width = progress + "%";
          if (progress >= 100) {
            clearInterval(interval);
            form.submit();
          }
        }, 30);
      });
    }
    attachFakeProgress("hide-form");
    attachFakeProgress("extract-form");

    // Scroll-to-section buttons (if you want navbar links to scroll)
    const hideBtn = document.getElementById("hide-btn");
    if (hideBtn) {
      hideBtn.addEventListener("click", function (e) {
        e.preventDefault();
        localStorage.setItem("scrollTarget", "hide-focus");
        window.location.href = "/stego";
      });
    }

    const extractBtn = document.getElementById("extract-btn");
    if (extractBtn) {
      extractBtn.addEventListener("click", function (e) {
        e.preventDefault();
        localStorage.setItem("scrollTarget", "extract-focus");
        window.location.href = "/stego";
      });
    }

    // Scroll target restore
    const scrollTarget = localStorage.getItem("scrollTarget");
    if (scrollTarget) {
      const el = document.getElementById(scrollTarget);
      if (el) {
        el.scrollIntoView({ behavior: "smooth" });
      }
      localStorage.removeItem("scrollTarget");
    }

    // Drag and drop
    function enableDragAndDrop(dropBoxSelector, inputId) {
      const dropBox = document.querySelector(dropBoxSelector);
      const fileInput = document.getElementById(inputId);
      if (!dropBox || !fileInput) return;

      dropBox.addEventListener("dragover", (e) => {
        e.preventDefault();
        dropBox.classList.add("dragover");
      });
      dropBox.addEventListener("dragleave", () => {
        dropBox.classList.remove("dragover");
      });
      dropBox.addEventListener("drop", (e) => {
        e.preventDefault();
        dropBox.classList.remove("dragover");
        if (e.dataTransfer.files.length) {
          fileInput.files = e.dataTransfer.files;
          fileInput.dispatchEvent(new Event("change"));
        }
      });
    }
    enableDragAndDrop(".encrypt-section .drop-box", "cover_jpeg");
    enableDragAndDrop(
      ".encrypt-section .drop-box:nth-of-type(2)",
      "secret_png"
    );
    enableDragAndDrop(".decrypt-section .drop-box", "stego_jpeg");
  });

  
</script>
{% endblock %}
